
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/graph/compute_nhood_enrichment.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

  .. container:: binder-badge

    .. image:: images/binder_badge_logo.svg
      :target: https://mybinder.org/v2/gh/theislab/squidpy_notebooks/master?filepath=docs/source/auto_examples/graph/compute_nhood_enrichment.ipynb
      :alt: Launch binder
      :width: 150 px

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_graph_compute_nhood_enrichment.py:

Neighbors enrichment analysis
-----------------------------

This example shows how to run the neighbors enrichment analysis routine.

It calculates an enrichment score based on proximity on the connectivity graph of cell clusters.
The number of observed events is compared against :math:`N` permutations and a *z-score* is computed.

.. seealso::

    See :ref:`sphx_glr_auto_examples_graph_compute_spatial_neighbors.py` for general usage of
    :func:`squidpy.gr.spatial_neighbors`.

.. GENERATED FROM PYTHON SOURCE LINES 16-22

.. code-block:: default


    import squidpy as sq

    adata = sq.datasets.visium_fluo_adata()
    adata





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0.00/242M [00:00<?, ?B/s]      0%|          | 56.0k/242M [00:00<10:17, 411kB/s]      0%|          | 264k/242M [00:00<03:59, 1.06MB/s]      0%|          | 1.12M/242M [00:00<01:12, 3.49MB/s]      2%|1         | 4.52M/242M [00:00<00:20, 12.1MB/s]      4%|4         | 10.4M/242M [00:00<00:10, 23.4MB/s]      7%|6         | 15.9M/242M [00:00<00:08, 29.4MB/s]      9%|8         | 21.8M/242M [00:00<00:06, 33.8MB/s]     11%|#1        | 27.6M/242M [00:01<00:06, 36.7MB/s]     14%|#3        | 33.3M/242M [00:01<00:05, 38.4MB/s]     16%|#6        | 39.1M/242M [00:01<00:05, 39.7MB/s]     19%|#8        | 44.9M/242M [00:01<00:05, 40.8MB/s]     21%|##        | 50.6M/242M [00:01<00:04, 41.3MB/s]     23%|##3       | 56.5M/242M [00:01<00:04, 42.0MB/s]     26%|##5       | 62.4M/242M [00:01<00:04, 42.4MB/s]     28%|##8       | 68.2M/242M [00:02<00:04, 42.6MB/s]     31%|###       | 74.0M/242M [00:02<00:04, 42.7MB/s]     33%|###2      | 79.8M/242M [00:02<00:03, 42.8MB/s]     35%|###5      | 85.6M/242M [00:02<00:03, 42.7MB/s]     38%|###7      | 91.4M/242M [00:02<00:03, 42.8MB/s]     40%|####      | 97.2M/242M [00:02<00:03, 42.9MB/s]     43%|####2     | 103M/242M [00:02<00:03, 43.0MB/s]      45%|####4     | 109M/242M [00:03<00:03, 43.0MB/s]     47%|####7     | 115M/242M [00:03<00:03, 43.3MB/s]     50%|####9     | 121M/242M [00:03<00:02, 43.5MB/s]     52%|#####2    | 127M/242M [00:03<00:02, 43.2MB/s]     55%|#####4    | 132M/242M [00:03<00:02, 42.9MB/s]     57%|#####7    | 138M/242M [00:03<00:02, 42.6MB/s]     59%|#####9    | 144M/242M [00:03<00:02, 42.3MB/s]     62%|######1   | 149M/242M [00:04<00:02, 42.2MB/s]     64%|######4   | 155M/242M [00:04<00:02, 42.4MB/s]     67%|######6   | 161M/242M [00:04<00:01, 42.8MB/s]     69%|######8   | 167M/242M [00:04<00:01, 42.6MB/s]     71%|#######1  | 173M/242M [00:04<00:01, 42.8MB/s]     74%|#######3  | 178M/242M [00:04<00:01, 42.6MB/s]     76%|#######6  | 184M/242M [00:04<00:01, 42.6MB/s]     79%|#######8  | 190M/242M [00:05<00:01, 42.9MB/s]     81%|########  | 196M/242M [00:05<00:01, 42.5MB/s]     83%|########3 | 202M/242M [00:05<00:00, 43.1MB/s]     85%|########5 | 207M/242M [00:05<00:00, 45.0MB/s]     87%|########6 | 210M/242M [00:05<00:00, 41.6MB/s]     89%|########8 | 215M/242M [00:05<00:00, 44.8MB/s]     90%|######### | 219M/242M [00:05<00:00, 41.5MB/s]     93%|#########2| 224M/242M [00:05<00:00, 44.9MB/s]     94%|#########3| 228M/242M [00:06<00:00, 41.3MB/s]     96%|#########6| 233M/242M [00:06<00:00, 45.4MB/s]     98%|#########7| 236M/242M [00:06<00:00, 41.5MB/s]    100%|#########9| 242M/242M [00:06<00:00, 46.4MB/s]    100%|##########| 242M/242M [00:06<00:00, 40.0MB/s]

    AnnData object with n_obs × n_vars = 2800 × 16562
        obs: 'in_tissue', 'array_row', 'array_col', 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes', 'total_counts_MT', 'log1p_total_counts_MT', 'pct_counts_MT', 'n_counts', 'leiden', 'cluster'
        var: 'gene_ids', 'feature_types', 'genome', 'MT', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts', 'n_cells', 'highly_variable', 'highly_variable_rank', 'means', 'variances', 'variances_norm'
        uns: 'cluster_colors', 'hvg', 'leiden', 'leiden_colors', 'neighbors', 'pca', 'spatial', 'umap'
        obsm: 'X_pca', 'X_umap', 'spatial'
        varm: 'PCs'
        obsp: 'connectivities', 'distances'



.. GENERATED FROM PYTHON SOURCE LINES 23-25

This dataset contains cell type annotations in :attr:`anndata.Anndata.obs` which are used for calculation of the
neighborhood enrichment. First, we need to compute a connectivity matrix from spatial coordinates.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: default

    sq.gr.spatial_neighbors(adata)








.. GENERATED FROM PYTHON SOURCE LINES 28-29

Then we can calculate the neighborhood enrichment score with :func:`squidpy.gr.nhood_enrichment`.

.. GENERATED FROM PYTHON SOURCE LINES 29-31

.. code-block:: default

    sq.gr.nhood_enrichment(adata, cluster_key="cluster")





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

      0%|          | 0/1000 [00:00<?, ?/s]     16%|#5        | 158/1000 [00:00<00:00, 1579.21/s]     39%|###9      | 393/1000 [00:00<00:00, 2027.90/s]     62%|######2   | 624/1000 [00:00<00:00, 2154.13/s]    100%|##########| 1000/1000 [00:00<00:00, 2714.41/s]




.. GENERATED FROM PYTHON SOURCE LINES 32-33

And visualize the results with :func:`squidpy.pl.nhood_enrichment`.

.. GENERATED FROM PYTHON SOURCE LINES 33-34

.. code-block:: default

    sq.pl.nhood_enrichment(adata, cluster_key="cluster")



.. image-sg:: /auto_examples/graph/images/sphx_glr_compute_nhood_enrichment_001.png
   :alt: Neighborhood enrichment
   :srcset: /auto_examples/graph/images/sphx_glr_compute_nhood_enrichment_001.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  13.201 seconds)

**Estimated memory usage:**  281 MB


.. _sphx_glr_download_auto_examples_graph_compute_nhood_enrichment.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: compute_nhood_enrichment.py <compute_nhood_enrichment.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: compute_nhood_enrichment.ipynb <compute_nhood_enrichment.ipynb>`
